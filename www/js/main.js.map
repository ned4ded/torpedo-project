{"version":3,"sources":["terminal.js"],"names":["FormSubmit","instance","_classCallCheck","this","callbacks","pending","fail","success","default","getAttribute","innerText","_createClass","key","value","name","setAttribute","setStatus","trigger","regular","_len","arguments","length","args","Array","_key","forEach","cb","fn","submit","addEventListener","ev","bind","FormsRegister","action","arr","_this","forms","form","add","afterRequest","beforeRequest","sended","FormData","_this2","_len2","_key2","req","XMLHttpRequest","submits","getSubmits","s","set","cbsBefore","_this3","_len3","_key3","cbs","apply","undefined","open","send","getFormData","reduce","acc","_ref","concat","_toConsumableArray","Object","keys","includes","Error","_this4","HTMLFormElement","from","querySelectorAll","meta","map","onClick","checkValidity","preventDefault","sendRequest","document","filter","f","hasAttribute","reg","find","on","classList","remove","disabled"],"mappings":"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","file":"main.js","sourcesContent":["(() => {\n  class FormSubmit {\n    constructor(instance) {\n      this.callbacks = {\n        pending: [],\n        fail: [],\n        success: [],\n      }\n\n      this.instance = instance;\n\n      this.default = instance.getAttribute('data-regular') || instance.innerText;\n      this.pending = instance.getAttribute('data-pending') || null;\n      this.fail = instance.getAttribute('data-fail') || null;\n      this.success = instance.getAttribute('data-success') || null;\n    }\n\n    setStatus(name) {\n      this.instance.setAttribute('data-status', name);\n\n      return this;\n    }\n\n    set(name) {\n      switch (name) {\n        case 'pending':\n          this.setStatus('pending');\n          this.instance.innerText = this.pending;\n          this.trigger('pending', this);\n          break;\n        case 'success':\n          this.setStatus('success');\n          this.instance.innerText = this.success;\n          this.trigger('success', this);\n          break;\n        case 'fail':\n          this.setStatus('fail');\n          this.instance.innerText = this.fail;\n\n          this.trigger('fail', this);\n          break;\n        default:\n          this.setStatus('regular');\n          this.instance.innerText = this.regular;\n\n          break;\n      }\n\n      return this;\n    }\n\n    trigger(name, ...args) {\n      this.callbacks[name].forEach(cb => cb(...args));\n\n      return this;\n    }\n\n    on(name, fn) {\n      const callbacks = [ ...this.callbacks[name], fn ];\n\n      this.callbacks[name] = callbacks;\n\n      return this;\n    }\n\n\n    onClick(fn) {\n      const submit = this;\n\n      this.instance.addEventListener('click', function(ev) {\n        return fn.bind(this)(ev,  submit);\n      });\n\n      return this;\n    }\n  }\n\n  class FormsRegister {\n    constructor(action, arr) {\n      this.action = action;\n\n      this.forms = [];\n\n      arr.forEach(form => this.add(form));\n\n      this.callbacks = {\n        afterRequest: [],\n        beforeRequest: [],\n      }\n\n      this.sended = false;\n    }\n\n    getFormData() {\n      return new FormData( this.forms[0].instance );\n    }\n\n    sendRequest(...args) {\n      if(this.sended) return;\n\n      this.sended = true;\n\n      const req = new XMLHttpRequest();\n\n      const submits = this.getSubmits();\n\n      submits.forEach(s => s.set('pending'));\n\n      const cbsBefore = this.callbacks.beforeRequest;\n\n      cbsBefore.length ? cbsBefore.forEach(cb => cb(...args)) : null;\n\n      const getCallbacksAfter = () => this.callbacks.afterRequest;\n      const getCallbacksFail = () => this.callbacks.failRequest;\n\n      req.addEventListener(\"load\", function(...args) {\n        const cbs = getCallbacksAfter();\n\n        cbs.length ? cbs.forEach(cb => cb.bind(this)(...args)) : null;\n\n        submits.forEach(s => s.set('success'));\n\n        return;\n      });\n\n      req.addEventListener(\"error\", (...args) => {\n\n        submits.forEach(s => s.set('fail'));\n\n        this.sended = false;\n\n        return;\n      });\n\n      req.open('POST', this.action);\n\n      req.send( this.getFormData() );\n\n      return this;\n    }\n\n    getSubmits() {\n      return this.forms.reduce((acc, { submits }) => [...acc, ...submits], []);\n    }\n\n    on(name, fn) {\n      if(!Object.keys(this.callbacks).includes(name)) throw new Error('FormsRegister: dont have such event');\n\n      const callbacks = [ ...this.callbacks[name], fn ];\n\n      this.callbacks[name] = callbacks;\n\n      return this;\n    }\n\n    add(form) {\n      if(!(form instanceof HTMLFormElement)) throw new Error('FormsRegister: passed invalid form element');\n\n      const submits = Array.from(form.querySelectorAll('[type=\"submit\"]'));\n\n      const meta = {\n        instance: form,\n        submits: submits.length ? submits.map(s => new FormSubmit(s)) : null,\n      }\n\n      meta.submits.forEach(s => s.onClick((ev) => {\n        if(!form.checkValidity()) return;\n\n        ev.preventDefault();\n\n        this.sendRequest(s, form, meta);\n\n        return;\n      }));\n\n\n      this.forms = [ ...this.forms, meta ];\n\n      return this;\n    }\n  }\n\n  const forms = Array.from(document.forms).filter(f => f.hasAttribute('data-form'));\n  const action = forms.find(() => true).getAttribute('action');\n\n  const reg = new FormsRegister(action, forms);\n  const submits = reg.getSubmits();\n\n\n  submits.forEach(s => s.on('success', (submit) => {\n    submit.instance.classList.remove(\"form__submit--pending\");\n    submit.instance.classList.add(\"form__submit--disabled\");\n\n    submit.instance.disabled = true;\n  }));\n\n  submits.forEach(s => s.on('pending', (submit) => {\n    submit.instance.classList.add(\"form__submit--pending\");\n  }));\n\n  submits.forEach(s => s.on('fail', (submit) => {\n    submit.instance.classList.remove(\"form__submit--pending\");\n  }));\n\n  reg.on('afterRequest', function() {\n\n  })\n\n})()\n"]}